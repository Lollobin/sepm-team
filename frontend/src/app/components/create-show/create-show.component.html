<div *ngIf="error" class="alert alert-warning alert-dismissible fade show" role="alert">
    <strong>Error occured: </strong> {{ errorMessage }}
    <button *ngIf="!this.notFound" type="button" (click)="vanishError()" class="close" data-dismiss="alert"
        aria-label="Close">
        <span aria-hidden="true">&times;</span>
    </button>
</div>

<div *ngIf="role !== 'ADMIN'" class="alert alert-warning alert-dismissible fade show" role="alert">
    <strong>Authentication error: </strong> Only admins are allowed to create shows for events
</div>


<div *ngIf="role === 'ADMIN' && !this.notFound">
    <p class="h2 form-margin form-group">
        <fa-icon style="padding-left: 0; font-size: 20px;" [icon]="faCircleQuestion" data-bs-toggle="tooltip"
            data-placement="bottom"
            title="In this step a specific show is created. It specifies the given event and gives it a date, a location, a seating plan and artists. After the seating plan is selected make sure to use the corresponding button to render the sectors!">
        </fa-icon>
        Add shows to "{{this.eventName}}"
    </p>

    <form class="form-margin" [formGroup]="showForm">
        <div class="form-group">
            <small for="name" class="form-label text-muted">Event Name</small>
            <div type="text" class="form-control" style="border-top: 0; border-left: 0; border-right: 0">
                {{this.eventName}}</div>
        </div>
        <div class="row">
            <div class="form-group col-md-6">
                <small for="inputCategory" class="form-label text-muted">Event Category</small>
                <div class="form-control form-override"
                    style="border-top: 0; border-left: 0; border-right: 0; margin-bottom: 20px;">{{this.eventCategory}}
                </div>
            </div>
            <div class="form-group col-md-6">
                <small for="inputCategory" class="form-label text-muted">Event Duration</small>
                <div class="form-control form-override" style="border-top: 0; border-left: 0; border-right: 0">
                    {{this.secondsToHms(this.eventDuration)}}</div>
            </div>
        </div>




        <div class="row">
            <div class="form-group col-md-6">
                <small for="inputDate" class="form-label text-muted">Date</small>
                <input id="inputDate" class="form-control form-override" [class.is-invalid]="!this.date.valid"
                    [class.is-valid]="this.date.valid" formControlName="date" type="date" placeholder="yyyy-mm-dd">
                <div *ngIf="!this.date.valid" class="invalid-feedback" style="display: block">
                    <div *ngIf="this.date.errors.required">Date is required!</div>
                    <div *ngIf="!this.date.errors.required">Date is invalid!</div>
                </div>
            </div>
            <div class="form-group col-md-6">
                <small for="inputTime" class="form-label text-muted">Time</small>
                <input class="form-control form-override" type="time" formControlName="time"
                    [class.is-invalid]="!this.time.valid" [class.is-valid]="this.time.valid">
                <div *ngIf="!this.time.valid" class="invalid-feedback" style="display: block">
                    <div *ngIf="this.time.errors.required">Time is required!</div>
                    <div *ngIf="!this.time.errors.required">Time is invalid!</div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="form-group col-md-6">
                <small for="inputLocation" class="form-label text-muted">Location Name</small>
                <input class="form-control" type="text" formControlName="location" [ngbTypeahead]="locationSearch"
                    #instance="ngbTypeahead" [resultFormatter]="locationFormatter" [inputFormatter]="locationFormatter" 
                    [class.is-invalid]="!this.locationValid" [class.is-valid]="this.locationValid"/>
                <div *ngIf="!this.locationValid" class="invalid-feedback" style="display: block">
                    <div *ngIf="this.time.errors.required">Location is required!</div>
                </div>
            </div>
            <div class="form-group col-md-6">
                <small for="inputSeatingPlan" class="form-label text-muted">Room/Seating Plan</small>
                <select *ngIf="!this.locationValid" class="form-control form-override" style="background-position: 92%" disabled></select>
                <div *ngIf="!this.locationValid" class="invalid-feedback" style="display: block">
                    <div>Please select a location first!</div>
                </div>
                <select *ngIf="this.locationValid" id="inputSeatingPlan" class="form-control form-override" [class.is-invalid]="!this.seatingPlan.valid"
                    [class.is-valid]="this.seatingPlan.valid" formControlName="seatingPlan" style="background-position: 92%">
                    <option hidden="true">Pick one</option>
                    <option *ngFor="let seatingPlan of seatingPlans" [ngValue]="seatingPlan">{{seatingPlan.name}}</option>
                </select>
            </div>
        </div>
        <div class="form-group" *ngIf="!this.showForm.value.seatingPlan">
            <small for="inputArtists" class="form-label text-muted">Sector Prices</small>
            <div class="invalid-feedback" style="display: block">Please select a seating plan first!</div>
        </div>
        <div [formGroup]="sectorForm" class="form-group" *ngIf="this.showForm.value.seatingPlan">
            <small for="inputArtists" class="form-label text-muted">Sector Prices</small>
            <div class="container">
                <div class="row" *ngIf="this.gotFromSeatingPlan===this.showForm.value.seatingPlan.seatingPlanId">
                    <small class="col-md-3 form-label text-muted input-icon input-icon-right"
                        *ngFor="let field of sectors; let i = index">
                        Sector {{i + 1}}
                        <div class="input-group">
                            <div class="input-group-addon" style="margin-right: 5px; font-size: 20px">â‚¬</div>
                            <input [class.is-valid]="this.sectorForm.valid" [class.is-invalid]="!this.sectorForm.valid"
                                [formControlName]="'sector'+field.sectorId" class="form-control currency"
                                style="text-align: right" name="currency" type="number" min="0.01" />
                        </div>
                    </small>
                    <div *ngIf="!this.sectorForm.valid && this.showForm.value.seatingPlan" class="invalid-feedback"
                        style="display: block">
                        <div>Correct prices are required for every sector</div>
                    </div>

                </div>
                <!-- <div
                    *ngIf="(this.showForm.value.seatingPlan && (!this.sectors || this.gotFromSeatingPlan!==this.showForm.value.seatingPlan))">
                    <button class="invalid-feedback btn btn-warning" style="display: block"
                        (click)="getSectorsOfSeatingPlan(this.showForm.value.seatingPlan)">
                        Click here to render the sectors
                    </button>
                    <div class="invalid-feedback" style="display: block">
                        <div>Sectors have to be rendered to set prices!</div>
                    </div>
                </div> -->
            </div>
        </div>
        <div class="form-group">
            <small for="inputArtists" class="form-label text-muted">Artists</small>
        </div>
        <button type="submit" class="btn btn-primary form-group" (click)="createShow()"
            [disabled]="!this.showForm.valid || !this.sectorForm.valid || !this.sectors || this.gotFromSeatingPlan!==this.showForm.value.seatingPlan.seatingPlanId">Submit</button>
        <!-- TODO: add *ngif to below div element to check wether there are shows for the given event -->
        <div class="form-group">
            <small for="inputLocation" class="form-label text-muted">Shows of "{{this.eventName}}"</small>
        </div>
    </form>
</div>